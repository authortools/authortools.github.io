<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивный Тест по Философии</title>
    <style>
        /* CSS Стили для приятного интерфейса */
        :root {
            --primary-color: #4a69bd;
            --light-bg: #f7f9fc;
            --dark-text: #333;
            --light-text: #666;
            --border-color: #e0e0e0;
            --correct-bg: #e8f5e9;
            --correct-border: #a5d6a7;
            --incorrect-bg: #ffebee;
            --incorrect-border: #ef9a9a;
            --missed-correct-bg: #e3f2fd;
            --missed-correct-border: #90caf9;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--light-bg);
            color: var(--dark-text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            padding: 30px;
        }
        
        h1, h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            text-align: center;
        }

        .question-block, .result-question-block {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .answer-option {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .answer-option:hover {
            background-color: #f1f3f5;
        }

        .answer-option input {
            margin-right: 15px;
        }

        .controls {
            text-align: center;
            margin-top: 30px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        button:hover {
            background-color: #5d81d2;
        }

        button:active {
            transform: scale(0.98);
        }

        #results-screen h2 {
            margin-bottom: 20px;
        }
        
        .result-summary {
            font-size: 1.3em;
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--light-bg);
        }

        .correct-answer {
            background-color: var(--correct-bg);
            border-color: var(--correct-border);
        }

        .incorrect-answer {
            background-color: var(--incorrect-bg);
            border-color: var(--incorrect-border);
        }

        .missed-correct-answer {
            background-color: var(--missed-correct-bg);
            border-color: var(--missed-correct-border);
        }

    </style>
</head>
<body>

    <div class="container">
        <!-- Экран приветствия и начала теста -->
        <div id="start-screen">
            <h1>Тест по Философии</h1>
            <p style="text-align: center; font-size: 1.1em; color: var(--light-text);">
                Тест состоит из 10 случайных вопросов. Выберите ответы и нажмите "Завершить тест", чтобы увидеть результаты.
            </p>
            <div class="controls">
                <button id="start-btn">Начать тест</button>
            </div>
        </div>

        <!-- Экран с вопросами теста -->
        <div id="test-screen" style="display:none;">
            <!-- Вопросы будут сгенерированы сюда -->
        </div>

        <!-- Экран с результатами -->
        <div id="results-screen" style="display:none;">
            <h2>Результаты теста</h2>
            <div class="result-summary">
                <!-- Сводка результатов будет здесь -->
            </div>
            <h3>Разбор ответов:</h3>
            <div id="results-details">
                <!-- Детали по каждому вопросу будут здесь -->
            </div>
            <div class="controls">
                <button onclick="window.location.reload()">Начать новый тест</button>
            </div>
        </div>
    </div>

    <!-- 1. ПОДКЛЮЧАЕМ ДАННЫЕ ИЗ ФАЙЛА, СОЗДАННОГО PYTHON -->
    <script src="questions_data.js"></script>
    
    <!-- 2. ПИШЕМ ЛОГИКУ ПРИЛОЖЕНИЯ -->
    <script>
        const startScreen = document.getElementById('start-screen');
        const testScreen = document.getElementById('test-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startBtn = document.getElementById('start-btn');
        
        let testQuestions = [];

        // Функция для перемешивания массива (алгоритм Фишера-Йейтса)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Функция для генерации и отображения теста
        function generateTest() {
            testScreen.innerHTML = ''; // Очищаем контейнер
            testQuestions = shuffleArray([...questionsData]).slice(0, 10);

            testQuestions.forEach((q, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';
                questionBlock.id = `q-${index}`;

                const questionText = document.createElement('div');
                questionText.className = 'question-text';
                questionText.innerHTML = `<b>${index + 1}.</b> ${q.question_html}`;
                questionBlock.appendChild(questionText);

                const correctAnswersCount = q.answers.filter(a => a.score > 0).length;
                const inputType = correctAnswersCount > 1 ? 'checkbox' : 'radio';

                q.answers.forEach((answer, i) => {
                    const answerDiv = document.createElement('div');
                    answerDiv.className = 'answer-option';
                    
                    const input = document.createElement('input');
                    input.type = inputType;
                    input.name = `answer-${index}`;
                    input.id = `q-${index}-a-${i}`;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `q-${index}-a-${i}`;
                    label.innerHTML = answer.answer_html;

                    answerDiv.appendChild(input);
                    answerDiv.appendChild(label);
                    questionBlock.appendChild(answerDiv);
                });

                testScreen.appendChild(questionBlock);
            });

            const finishBtn = document.createElement('button');
            finishBtn.id = 'finish-btn';
            finishBtn.textContent = 'Завершить тест';
            
            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'controls';
            controlsDiv.appendChild(finishBtn);
            testScreen.appendChild(controlsDiv);

            finishBtn.addEventListener('click', showResults);
        }

        // Функция для подсчета и отображения результатов
        function showResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            const resultsDetails = document.getElementById('results-details');
            resultsDetails.innerHTML = '';

            testQuestions.forEach((q, index) => {
                const questionBlock = document.getElementById(`q-${index}`);
                const checkedInputs = questionBlock.querySelectorAll('input:checked');
                
                let totalScore = 0;
                let userAnswersIndexes = new Set();
                checkedInputs.forEach(input => {
                    const answerIndex = parseInt(input.id.split('-').pop());
                    userAnswersIndexes.add(answerIndex);
                    totalScore += q.answers[answerIndex].score;
                });
                
                if (totalScore >= 100) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
                
                // Создаем блок для разбора ответа
                const resultBlock = document.createElement('div');
                resultBlock.className = 'result-question-block';
                const questionText = document.createElement('div');
                questionText.className = 'question-text';
                questionText.innerHTML = `<b>${index + 1}.</b> ${q.question_html}`;
                resultBlock.appendChild(questionText);

                q.answers.forEach((answer, i) => {
                    const answerDiv = document.createElement('div');
                    answerDiv.className = 'answer-option';
                    
                    const isCorrect = answer.score > 0;
                    const isSelected = userAnswersIndexes.has(i);

                    if (isCorrect && isSelected) {
                        answerDiv.classList.add('correct-answer'); // Правильно выбранный
                    } else if (!isCorrect && isSelected) {
                        answerDiv.classList.add('incorrect-answer'); // Неправильно выбранный
                    } else if (isCorrect && !isSelected) {
                        answerDiv.classList.add('missed-correct-answer'); // Правильный, но не выбранный
                    }

                    answerDiv.innerHTML = answer.answer_html;
                    resultBlock.appendChild(answerDiv);
                });
                resultsDetails.appendChild(resultBlock);
            });
            
            // Обновляем сводку
            const summaryDiv = document.querySelector('.result-summary');
            summaryDiv.innerHTML = `
                <span style="color: green;">Правильных ответов: <b>${correctCount}</b></span><br>
                <span style="color: red;">Неправильных ответов: <b>${incorrectCount}</b></span>
            `;
            
            // Переключаем экраны
            testScreen.style.display = 'none';
            resultsScreen.style.display = 'block';
        }

        // Обработчик нажатия на кнопку "Начать"
        startBtn.addEventListener('click', () => {
            startScreen.style.display = 'none';
            testScreen.style.display = 'block';
            generateTest();
        });

    </script>
</body>
</html>